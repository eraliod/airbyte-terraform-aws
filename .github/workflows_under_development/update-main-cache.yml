name: Update Main Cache

on:
  push:
    branches:
      - main

jobs:
  update-pixi-environment-cache:
    name: Update pixi Environment Cache
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4
      - name: Set Up pixi Environment
        uses: prefix-dev/setup-pixi@v0.8.1
        with:
          pixi-version: v0.28.2

  update-pre-commit-cache:
    name: Update pre-commit Cache
    needs: update-pixi-environment-cache
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4
      - name: Set Up pixi Environment
        uses: prefix-dev/setup-pixi@v0.8.1
        with:
          pixi-version: v0.28.2
      - name: Restore pre-commit Cache
        uses: actions/cache@v4
        with:
          path: ~/.cache/pre-commit
          key: pre-commit|${{ hashFiles('.pre-commit-config.yaml') }}
          restore-keys: pre-commit
          save-always: true
      - name: Install pre-commit Hooks
        run: pixi run pre-commit install-hooks
